#pragma once
#include<math.h>
#include"Info.h"

//総エサ数　168の場合
const int FirstTime = 50;     //正:48
const int SecondTime = 120;   //正:117

////総エサ数　244の場合
//const int FirstTime = 70;
//const int SecondTime = 170;

class Stage
{
public:
	Stage();

	int MapPointX(int mapX);  //map上の"〇マス目"をウィンドウ上の座標に変換
	int MapPointY(int mapY);
	void DrawMap();           //描画

	//初期処理
	void StageInit();

	//画像読み込み
	int LoadImages();

	//フルーツの処理まとめ
	void FruitControl(int ClearCnt, int FoodCnt);

	//フルーツの出現、描画  　引数(食べたエサ数、クリア回数)
	//void DrawFruit(int FoodCnt, int ClearCnt);
	void DrawFruit(int ClearCnt);

	//クリア回数による出現フルーツの変化    DrawFruit内でのみ使用
	int* FruitToClear(int ClearCnt);

	//クリア回数による出現フルーツの変化 　画像No
	int FruitNumToClear(int ClearCnt);

	//食べられたときの処理　スコア表示
	void DrawFruitScore(int ClearCnt);

	//10進数の桁数を返す
	unsigned GetDigit(unsigned num) { return log10(num) + 1; }

	//数字と桁数から表示する数字を返す
	int ShowDigit(int digit, int num);

	//数字画像を取得
	int* GetNumImages(int num) { return &NumImgs[num]; }

	int getMap(int Y, int X);

	int Timer;
	int MAP_W_Flg;

	int flashingTimer;

	void DrawMapImageV3();
	void flashingMapImageV3();

	void DrawMapScore(int ClearCnt);
	int FruitCount;
	//void FruitScore(int ClearCnt);

	int HitCircle();

	struct CIRCLE
	{
		float x, y, r;//当たり判定・円
	};

	int Score;
	int HScore;
	int oldLife;
	int Fruit[10] = { 0 };

	bool CheckHit(const CIRCLE& t_circleA, const CIRCLE& t_circleB);

private:

	//Mapデータ[23][21]  
	int MapData[MAP_HEIGHT][MAP_WIDTH] =
	{
		//{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,},
  //      {1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,},
  //      {1,0,1,1,0,1,1,1,1,0,1,0,1,1,1,1,0,1,1,0,1,},
  //      {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
  //      {1,0,1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,1,0,1,},
  //      {1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,},
  //      {1,1,1,1,0,1,1,1,1,0,1,0,1,1,1,1,0,1,1,1,1,},
  //      {0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,},
  //      {0,0,0,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,0,0,0,},
  //      {1,1,1,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,1,1,1,},
  //      {0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,},
  //      {1,1,1,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,1,1,1,},
  //      {0,0,0,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,0,0,0,},
  //      {0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,},
  //      {1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,},
  //      {1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,},
  //      {1,0,1,1,0,1,1,1,1,0,1,0,1,1,1,1,0,1,1,0,1,},
  //      {1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,},
  //      {1,1,0,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,0,1,1,},
  //      {1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,},
  //      {1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,},
  //      {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
  //      {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,},
{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
{0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,},
{0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,},
{0,0,0,1,0,1,1,0,1,1,1,1,0,1,0,1,1,1,1,0,1,1,0,1,0,0,0,},
{0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,},
{0,0,0,1,0,1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,1,0,1,0,0,0,},
{0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,},
{0,0,0,1,1,1,1,0,1,1,1,1,0,1,0,1,1,1,1,0,1,1,1,1,0,0,0,},
{0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,},
{0,0,0,0,0,0,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,0,0,0,0,0,0,},
{0,0,0,1,1,1,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,1,1,1,0,0,0,},
{0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,},
{0,0,0,1,1,1,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,1,1,1,0,0,0,},
{0,0,0,0,0,0,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,},
{0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,},
{0,0,0,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,0,0,},
{0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,},
{0,0,0,1,0,1,1,0,1,1,1,1,0,1,0,1,1,1,1,0,1,1,0,1,0,0,0,},
{0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,},
{0,0,0,1,1,0,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,0,1,1,0,0,0,},
{0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,},
{0,0,0,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,0,0,},
{0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,},
{0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,},
{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	};

	int FruitImgs[8] = { 0 };  //フルーツ画像
	int DrawTime = 0;          //描画時間
	int DrawCnt = 0;           //表示回数　2回

	bool DrawFlg_F = false;    //フルーツ描画フラグ
	bool DrawFlg_S = false;    //スコア描画フラグ

	int NumImgs[10] = { 0 };   //数字画像

	int hit_count = 0;         //当たった瞬間のみを計算
	int DrawTime_F = 0;        //フルーツ描画時間
	int DrawTime_S = 0;        //スコア描画時間

	int FruitScore[8];         //フルーツスコア
};
extern Stage stage;